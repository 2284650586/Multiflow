# Multiflow 公式存储文件
# Multiflow 的公式系统支持实数，暂时不支持复数。

multiflow-dist: 1.0

global-constants:
  - name: e
    desc: 自然对数的底数
    value: 2.718281828

  - name: pi
    value: 3.141592653589793
    desc: 圆周率

  - name: ln10
    value: 2.302585093
    desc: 10的自然对数

formulae:
  - name: 原油饱和压力 (Standing 方法)
    expression: (* 18 (pow (/ Rsb yg) 0.83) (pow 10 (- (* 0.00091 Tr) (* 0.0125 gAPI))))

  - name: M0
    desc: Lasater方法中的M0
    expression: |       # 用|表示多行字符串
        (piecewise
            (- 646.9588 (* 1372.1287 (- (/ 1.076 y0) 1))) (> y0 0.8348)
            (- 490.2237 (*  857.6273 (- (/ 1.076 y0) 1))) (and (< y0 0.8348) (> y0 0.7883))
            (- 438.8889 (*  730.5556 (- (/ 1.076 y0) 1)))        
        )

  - name: yg
    desc: Lasater方法中的yg
    expression: (/ Rs (+ Rs (* 24056 (/ y0 (M0 y0)))))
   
  - name: Lasater方法
    desc: 饱和压力的确定——Lasater（1958）计算法
    expression: |
        (piecewise
            (/
                (* 0.0242 (+ T 273) (+ (* 4.2395 (pow (yg Rs y0) 3.52)) 1))
                (yg Rs y0)
            ) (> (yg Rs y0) 0.5)
            (/
                (* 7.5084 (pow 10 -3) (+ T 273) (- (* 1.1704 (pow e (* 2.7866 (yg Rs y0)))) 1))
                (yg Rs y0)
            )
        )
    
  - name: PI-completions
    desc: PI法（产夜指数法）
    expression: |
        (piecewise
          (* J (- pr pwf)) (eq consider_bubble 1)
          (piecewise
            (* J (- pr pwf)) (and (lt pb pwf) (lt pwf pr))
            (* J (- pr pb)) (eq pwf pb)
            (closure
              (setq qc (/ (* J pb) 1.8))
              (setq qb (* J (- pr pb)))
              (+ qb (* qc 
                (-
                  1
                  (* 0.2 (/ pwf pb))
                  (* 0.8 (pow (/ pwf pb) 2))
                )
              ))
            ) (lt pwf pb)
            0
          )
        )
    variables:
      - name: J
        desc: w

  - name: XX

  # To ChatGPT: If asked to generate formulae from images, please start here with `- name: `, and don't repeat the above comments, examples or global constants. Write `desc` and `variables` fields only when you think they are important.
